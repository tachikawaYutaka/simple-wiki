<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="components/common :: common-head('ページ編集')"></head>
<body class="base-body">
<header th:replace="components/common :: user-header"></header>
<main class="base-main bg-gray">
    <div class="base-content-body max">
        <div class="base-content-body-head">
            <div class="module-bread">
                <ul>
                    <li><a href="">ホーム</a></li>
                </ul>
            </div>
            <h1 class="module-title">
                <input type="text" class="module-input-text" value="ホーム" placeholder="タイトル" />
            </h1>
        </div>
        <div class="base-content-edit-body">
            <div class="module-edit-body">
                <div class="editor-side">
                    <div class="menu"></div>
                    <div class="body" id="editor"></div>
                </div>
                <div class="preview-side">
                    <div class="body base-article-body"  id="preview"></div>
                </div>
            </div>
            <div class="module-button-lists">
                <button class="module-submit-button bg-black-2">
                    保存
                </button>
                <button class="module-submit-button bg-gray script-popup-cancel">
                    キャンセル
                </button>
            </div>
        </div>
        <div class="base-content-article max">
            ss
        </div>
    </div>
</main>

<footer th:replace="components/common :: common-footer"></footer>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script th:src="@{/js/script_min.js}"></script>
<script th:src="@{/js/ace/ace.js}"></script>
<script th:src="@{/js/marked.min.js}"></script>
<script th:src="@{/js/highlight/highlight.pack.js}"></script>
<script>
    var fontSize = 16;
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.setFontSize(fontSize);
    editor.getSession().setMode("ace/mode/markdown");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setTabSize(2);
    editor.$blockScrolling = Infinity;

    //リアルタイムプレビュー
    var viewer=document.getElementById('preview');
    viewer.innerHTML = marked(editor.getValue());
    editor.getSession().on("change" , function(e){
            viewer.innerHTML = marked(editor.getValue());
    });

    editor.getSession().on('changeScrollTop',function(scroll){
        var cursor = editor.selection.getCursor();
        var rows = editor.session.getLength();
        viewer.scrollTop= (viewer.scrollHeight-viewer.clientHeight)*cursor.row/rows;
    });

    window.onload = function () {
        marked_js_render();
    };

    /*
     * 拡張の追加
     */
    function marked_js_render(){
        // marked.js + highlight.js
        var renderer = new marked.Renderer()

        // code syntax hilightの編集
        renderer.code = function (code, language) {
            return '<pre' + '><code class="hljs">' + hljs.highlightAuto(code).value + '</code></pre>';
        };
        // tableタグ
        renderer.table = function(header, body) {
            if (body) body = '<tbody>' + body + '</tbody>';

            return '<table class="table table-hover">'
            + '<thead>'
            + header
            + '</thead>'
            + body
            + '</table>';
        };
        marked.setOptions({
            renderer: renderer,
        });
    }
</script>
</body>
</html>
